# DevSecOps360 – Phase-1 Backend Handoff

## Objective

This document explains the Phase-1 backend responsibilities for the
DevSecOps360 Terraform Assessment MVP.

The backend is **read-only** and serves assessment results generated by
an existing Python pipeline.

---

## High-Level Flow

UI → Backend API → Local run folders (filesystem)

- No server deployment yet
- No database
- No terraform apply
- Backend only reads files and returns JSON

---

## Assessment Output Structure

Each assessment execution creates a folder under `runs/`.

```

runs/
└── <run_id>/
├── metadata/
│   └── metadata.json
├── reports/
│   ├── iac/
│   │   └── tfsec.json
│   ├── tf/
│   │   └── tfplan.json
│   └── opa/
│       └── opa_decision.json
└── logs/
└── *.log

```

> Note: `runs/` is runtime-generated and gitignored.

---

## Local Testing Setup

A sample bundle is provided for development.

```

sample-runs.tgz

```

Steps:
1. Extract the archive locally
2. Set environment variable:

```

RUNS_BASE_PATH=<extracted-path>/runs

```

Backend must read all files relative to this path.

---

## API Responsibilities (NodeJS)

### GET /runs

Returns a list of all assessment runs.

Backend behavior:
- Scan folders under `RUNS_BASE_PATH`
- Read `metadata/metadata.json` for each run

---

### GET /runs/{run_id}

Returns aggregated data for a single run.

Files to read:
- metadata/metadata.json
- reports/iac/tfsec.json
- reports/tf/tfplan.json
- reports/opa/opa_decision.json

---

### GET /runs/{run_id}/artifacts/{name}

Returns raw artifact files for download.

Examples:
- tfsec.json
- tfplan.json
- opa_decision.json
- log files

---

## Out of Scope (Phase-1)

- POST /runs
- Triggering Python execution
- Authentication / Authorization
- Azure deployment
- Database integration

---

## Key Clarification

Backend acts purely as a **filesystem reader over assessment results**.

No state mutation is required.
```

---



# **3️⃣ Exact API Response JSON Samples (Very Important for UI)**

### **GET /runs**

```json
[
  {
    "run_id": "2026-01-28T083604Z-unknown-a43942",
    "client": "ttms",
    "cloud": "azure",
    "scope": "network",
    "status": "IN_PROGRESS",
    "started_at": "2026-01-28T08:36:04Z"
  },
  {
    "run_id": "2026-01-27T060746Z-unknown-467a2f",
    "client": "ttms",
    "cloud": "azure",
    "scope": "network",
    "status": "COMPLETED",
    "started_at": "2026-01-27T06:07:46Z"
  }
]
```

---

### **GET /runs/{id}**

```json
{
  "run_id": "2026-01-28T083604Z-unknown-a43942",
  "metadata": {
    "client": "ttms",
    "cloud": "azure",
    "scope": "network",
    "final_status": "POLICY_PASSED"
  },
  "tfsec": {
    "critical": 0,
    "high": 1,
    "medium": 2,
    "low": 3
  },
  "terraform_plan": {
    "resources_to_add": 0,
    "resources_to_change": 0,
    "resources_to_destroy": 0
  },
  "opa": {
    "decision": "allow",
    "violations": []
  }
}
```

---

### **GET /runs/{id}/artifacts/tfsec.json**

```json
{
  "tool": "tfsec",
  "results": [
    {
      "rule_id": "AZU001",
      "severity": "HIGH",
      "description": "NSG allows public SSH access"
    }
  ]
}
```
